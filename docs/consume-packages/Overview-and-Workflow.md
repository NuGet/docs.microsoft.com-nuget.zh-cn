---
title: 使用 NuGet 包的概述和工作流
description: 概述在项目中使用 NuGet 包的流程，其中提供该流程其他特定部分的链接。
author: karann-msft
ms.author: karann
ms.date: 03/22/2018
ms.topic: conceptual
ms.openlocfilehash: eeae62a09a9f405d27cd113ff586393f6305ba47
ms.sourcegitcommit: b6810860b77b2d50aab031040b047c20a333aca3
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/28/2019
ms.locfileid: "67426715"
---
# <a name="package-consumption-workflow"></a><span data-ttu-id="b04bb-103">包使用工作流</span><span class="sxs-lookup"><span data-stu-id="b04bb-103">Package consumption workflow</span></span>

<span data-ttu-id="b04bb-104">在 nuget.org 和组织可能会建立的私有包库之间，可以找到数以万计的非常有用的包，这些包可在应用和服务中使用。</span><span class="sxs-lookup"><span data-stu-id="b04bb-104">Between nuget.org and private package galleries that your organization might establish, you can find tens of thousands of highly useful packages to use in your apps and services.</span></span> <span data-ttu-id="b04bb-105">无论源在哪里，使用包时都遵循相同的常规工作流。</span><span class="sxs-lookup"><span data-stu-id="b04bb-105">But regardless of the source, consuming a package follows the same general workflow.</span></span>

![前往包源、查找包、在项目中安装包然后添加 using 语句和对包 API 的调用的流](media/Overview-01-GeneralFlow.png)

<span data-ttu-id="b04bb-107">\* _仅 Visual Studio 和 `dotnet.exe`。`nuget install` 命令不会修改项目文件或 `packages.config` 文件；必须手动管理条目。_</span><span class="sxs-lookup"><span data-stu-id="b04bb-107">\* _Visual Studio and `dotnet.exe` only. The `nuget install` command does not modify project files or the `packages.config` file; entries must be managed manually._</span></span>

<span data-ttu-id="b04bb-108">有关详细信息，请参阅[查找和选择包](../consume-packages/finding-and-choosing-packages.md)和[安装包时会发生什么情况？](../concepts/package-installation-process.md)。</span><span class="sxs-lookup"><span data-stu-id="b04bb-108">For further details, see [Finding and Choosing Packages](../consume-packages/finding-and-choosing-packages.md) and [What happens when a package is installed?](../concepts/package-installation-process.md).</span></span>

<span data-ttu-id="b04bb-109">NuGet 会记住每个已安装包的标识和版本号，并将其录制到项目文件（使用 [PackageReference](../consume-packages/package-references-in-project-files.md)）或 [`packages.config`](../reference/packages-config.md) 中，具体取决于项目类型和 NuGet 版本。</span><span class="sxs-lookup"><span data-stu-id="b04bb-109">NuGet remembers the identity and version number of each installed package, recording it in either the project file (using [PackageReference](../consume-packages/package-references-in-project-files.md)) or [`packages.config`](../reference/packages-config.md), depending on project type and your version of NuGet.</span></span> <span data-ttu-id="b04bb-110">若为 NuGet 4.0+，则 PackageReference 为首选方法，虽然这可在 Visual Studio 中通过[包管理器 UI](../tools/package-manager-ui.md) 进行配置。</span><span class="sxs-lookup"><span data-stu-id="b04bb-110">With NuGet 4.0+, PackageReference is preferred, although this is configurable in Visual Studio through the [Package Manager UI](../tools/package-manager-ui.md).</span></span> <span data-ttu-id="b04bb-111">在任何情况下，可以随时在相应文件中进行搜索，查看项目依赖项的完整列表。</span><span class="sxs-lookup"><span data-stu-id="b04bb-111">In any case, you can look in the appropriate file at any time to see the full list of dependencies for your project.</span></span>

> [!Tip]
> <span data-ttu-id="b04bb-112">随时检查要在软件中使用的每个包的许可证是非常明智的做法。</span><span class="sxs-lookup"><span data-stu-id="b04bb-112">It's prudent to always check the license for each package you intend to use in your software.</span></span> <span data-ttu-id="b04bb-113">在 nuget.org 中，可以在每个包的说明页右侧找到“许可信息”链接  。</span><span class="sxs-lookup"><span data-stu-id="b04bb-113">On nuget.org, you find a **License Info** link on the right side of each package's description page.</span></span> <span data-ttu-id="b04bb-114">如果包未指定许可条款，请直接通过包页面上的“联系所有者”链接与包所有者联系  。</span><span class="sxs-lookup"><span data-stu-id="b04bb-114">If a package does not specify license terms, contact the package owner directly using the **Contact owners** link on the package page.</span></span> <span data-ttu-id="b04bb-115">Microsoft 不向用户授予任何第三方包提供程序的知识产权许可，同时不对第三方提供的信息承担任何责任。</span><span class="sxs-lookup"><span data-stu-id="b04bb-115">Microsoft does not license any intellectual property to you from third party package providers and is not responsible for information provided by third parties.</span></span>

<span data-ttu-id="b04bb-116">安装包时，NuGet 通常会检查此包是否已存在于其缓存中。</span><span class="sxs-lookup"><span data-stu-id="b04bb-116">When installing packages, NuGet typically checks if the package is already available from its cache.</span></span> <span data-ttu-id="b04bb-117">可手动从命令行中清除此缓存，如[管理全局包和缓存文件夹](../consume-packages/managing-the-global-packages-and-cache-folders.md)中所述。</span><span class="sxs-lookup"><span data-stu-id="b04bb-117">You can manually clear this cache from the command line, as described on [Managing the global packages and cache folders](../consume-packages/managing-the-global-packages-and-cache-folders.md).</span></span>

<span data-ttu-id="b04bb-118">NuGet 还可以确保包支持的目标框架与你的项目兼容。</span><span class="sxs-lookup"><span data-stu-id="b04bb-118">NuGet also makes sure that the target frameworks supported by the package are compatible with your project.</span></span> <span data-ttu-id="b04bb-119">如果包中不包含兼容的程序集，NuGet 将显示一个错误。</span><span class="sxs-lookup"><span data-stu-id="b04bb-119">If the package does not contain compatible assemblies, NuGet displays an error.</span></span> <span data-ttu-id="b04bb-120">请参阅[解决包不兼容错误](dependency-resolution.md#resolving-incompatible-package-errors)。</span><span class="sxs-lookup"><span data-stu-id="b04bb-120">See [Resolving incompatible package errors](dependency-resolution.md#resolving-incompatible-package-errors).</span></span>

<span data-ttu-id="b04bb-121">将项目代码添加到源存储库时，通常不需要包含 NuGet 包。</span><span class="sxs-lookup"><span data-stu-id="b04bb-121">When adding project code to a source repository, you typically don't include NuGet packages.</span></span> <span data-ttu-id="b04bb-122">如果用户要在后期克隆存储库或获取项目（包括 Visual Studio Team Services 等系统上的生成代理），则必须在运行生成前还原必要的包：</span><span class="sxs-lookup"><span data-stu-id="b04bb-122">Those who later clone the repository or otherwise acquire the project, including build agents on systems like Visual Studio Team Services, must restore the necessary packages prior to running a build:</span></span>

![通过克隆存储库并使用任一还原命令来还原 NuGet 包的流](media/Overview-02-RestoreFlow.png)

<span data-ttu-id="b04bb-124">[程序包还原](../consume-packages/package-restore.md)使用项目文件中的信息或 `packages.config` 重新安装所有依赖项。</span><span class="sxs-lookup"><span data-stu-id="b04bb-124">[Package Restore](../consume-packages/package-restore.md) uses the information in the project file or `packages.config` to reinstall all dependencies.</span></span> <span data-ttu-id="b04bb-125">请注意，此相关流程不尽相同，如[依赖项解析](../consume-packages/dependency-resolution.md)中所述。</span><span class="sxs-lookup"><span data-stu-id="b04bb-125">Note that there are differences in the process involved, as described in [Dependency Resolution](../consume-packages/dependency-resolution.md).</span></span> <span data-ttu-id="b04bb-126">此外，上图并未显示包管理器控制台的还原命令，因为已经在 Visual Studio 的上下文中使用了该控制台，它通常会自动还原包并提供所示的解决方案级别命令。</span><span class="sxs-lookup"><span data-stu-id="b04bb-126">Also, the diagram above does not show a restore command for the Package Manager Console because if you're with the Console you're already in the context of Visual Studio, which typically restores packages automatically and provides the solution-level command as shown.</span></span>

<span data-ttu-id="b04bb-127">有时需要重新安装项目中已包含的包，这可能导致重新安装依赖项。</span><span class="sxs-lookup"><span data-stu-id="b04bb-127">Occasionally it's necessary to reinstall packages that are already included in a project, which may also reinstall dependencies.</span></span> <span data-ttu-id="b04bb-128">使用 `nuget reinstall` 命令或使用 NuGet 包管理器控制台可轻松执行此操作。</span><span class="sxs-lookup"><span data-stu-id="b04bb-128">This is easy to do using the `nuget reinstall` command or the NuGet Package Manager Console.</span></span> <span data-ttu-id="b04bb-129">有关详细信息，请参阅[重新安装和更新包](../consume-packages/reinstalling-and-updating-packages.md)。</span><span class="sxs-lookup"><span data-stu-id="b04bb-129">For details, see [Reinstalling and Updating Packages](../consume-packages/reinstalling-and-updating-packages.md).</span></span>

<span data-ttu-id="b04bb-130">最后一点，NuGet 的行为由 `Nuget.Config` 文件驱动。</span><span class="sxs-lookup"><span data-stu-id="b04bb-130">Finally, NuGet's behavior is driven by `Nuget.Config` files.</span></span> <span data-ttu-id="b04bb-131">有多个文件可用于集中处理不同级别的特定设置，如[配置 NuGet 行为](../consume-packages/configuring-nuget-behavior.md)中所述。</span><span class="sxs-lookup"><span data-stu-id="b04bb-131">Multiple files can be used to centralize certain settings at different levels, as explained in [Configuring NuGet Behavior](../consume-packages/configuring-nuget-behavior.md).</span></span>

## <a name="ways-to-install-a-nuget-package"></a><span data-ttu-id="b04bb-132">安装 NuGet 包的方式</span><span class="sxs-lookup"><span data-stu-id="b04bb-132">Ways to install a NuGet Package</span></span>

<span data-ttu-id="b04bb-133">使用下表中的任何方法下载和安装 NuGet 包。</span><span class="sxs-lookup"><span data-stu-id="b04bb-133">NuGet packages are downloaded and installed using any of the methods in the following table.</span></span>

| <span data-ttu-id="b04bb-134">工具</span><span class="sxs-lookup"><span data-stu-id="b04bb-134">Tool</span></span> | <span data-ttu-id="b04bb-135">说明</span><span class="sxs-lookup"><span data-stu-id="b04bb-135">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="b04bb-136">dotnet.exe CLI</span><span class="sxs-lookup"><span data-stu-id="b04bb-136">dotnet.exe CLI</span></span>](install-use-packages-dotnet-cli.md) | <span data-ttu-id="b04bb-137">（所有平台）用于 .NET Core 和 .NET Standard 库，以及用于面向 .NET Framework 的 SDK 样式项目的 CLI 工具（请参阅 [SDK 属性](/dotnet/core/tools/csproj#additions)）。</span><span class="sxs-lookup"><span data-stu-id="b04bb-137">(All platforms) CLI tool for .NET Core and .NET Standard libraries, and for SDK-style projects that target .NET Framework (see [SDK attribute](/dotnet/core/tools/csproj#additions)).</span></span> <span data-ttu-id="b04bb-138">检索由 \<package_name\> 标识的包，并添加对项目文件的引用。</span><span class="sxs-lookup"><span data-stu-id="b04bb-138">Retrieves the package identified by \<package_name\> and adds a reference to the project file.</span></span> <span data-ttu-id="b04bb-139">同时还要检索和安装依赖项。</span><span class="sxs-lookup"><span data-stu-id="b04bb-139">Also retrieves and installs dependencies.</span></span> |
| <span data-ttu-id="b04bb-140">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="b04bb-140">Visual Studio</span></span> | <span data-ttu-id="b04bb-141">（Windows 和 Mac）提供 UI，用户可以通过此 UI 浏览、选择包，并从指定包源将包及其依赖项安装到项目中。</span><span class="sxs-lookup"><span data-stu-id="b04bb-141">(Windows and Mac) Provides a UI through which you can browse, select, and install packages and their dependencies into a project from a specified package source.</span></span> <span data-ttu-id="b04bb-142">将对已安装的程序包引用添加到项目文件。</span><span class="sxs-lookup"><span data-stu-id="b04bb-142">Adds references to installed packages to the project file.</span></span><ul><li>[<span data-ttu-id="b04bb-143">使用 Visual Studio 安装和管理包</span><span class="sxs-lookup"><span data-stu-id="b04bb-143">Install and manage packages using Visual Studio</span></span>](../tools/package-manager-ui.md)</li><li>[<span data-ttu-id="b04bb-144">在项目中包括 NuGet 包 (Mac)</span><span class="sxs-lookup"><span data-stu-id="b04bb-144">Including a NuGet package in your project (Mac)</span></span>](/visualstudio/mac/nuget-walkthrough)</li></ul> |
| [<span data-ttu-id="b04bb-145">Visual Studio 中的 PowerShell</span><span class="sxs-lookup"><span data-stu-id="b04bb-145">PowerShell in Visual Studio</span></span>](../tools/package-manager-console.md) | <span data-ttu-id="b04bb-146">（仅限 Windows）检索并将用 \<package_name\> 识别的包从所选源安装到解决方案的指定项目中，然后添加对项目文件的引用。</span><span class="sxs-lookup"><span data-stu-id="b04bb-146">(Windows only) Retrieves and installs the package identified by \<package_name\> from a selected source into a specified project in the solution, then adds a reference to the project file.</span></span> <span data-ttu-id="b04bb-147">同时还要检索和安装依赖项。</span><span class="sxs-lookup"><span data-stu-id="b04bb-147">Also retrieves and installs dependencies.</span></span> |
| [<span data-ttu-id="b04bb-148">nuget.exe CLI</span><span class="sxs-lookup"><span data-stu-id="b04bb-148">nuget.exe CLI</span></span>](install-use-packages-dotnet-cli.md) | <span data-ttu-id="b04bb-149">（所有平台）用于 .NET Framework 库和面向 .NET Standard 库的非 SDK 样式项目的 CLI 工具。</span><span class="sxs-lookup"><span data-stu-id="b04bb-149">(All platforms) CLI tool for .NET Framework libraries and non-SDK-style projects that target .NET Standard libraries.</span></span> <span data-ttu-id="b04bb-150">检索用 \<package_name\> 识别的包，将其内容展开到当前目录下的文件夹中；还可以检索 `packages.config` 文件中列出的所有包。</span><span class="sxs-lookup"><span data-stu-id="b04bb-150">Retrieves the package identified by \<package_name\> and expands its contents into a folder in the current directory; can also retrieve all packages listed in a `packages.config` file.</span></span> <span data-ttu-id="b04bb-151">同时还要检索和安装依赖项，但对项目文件或 `packages.config` 不作任何更改。</span><span class="sxs-lookup"><span data-stu-id="b04bb-151">Also retrieves and installs dependencies, but makes no changes to project files or `packages.config`.</span></span> |
